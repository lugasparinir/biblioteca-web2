<?php
$is_edit = $libro !== null;

$actionUrl = BASE_URL . 'savelibro'; 

$formTitle = $is_edit ? 'Editar Libro: ' . htmlspecialchars($libro->titulo ?? '') : 'Agregar Nuevo Libro';

$titulo = $libro->titulo ?? '';
$autor = $libro->autor ?? '';
$descripcion = $libro->descripcion ?? '';
$id_generoselec = $libro->id_genero ?? '';
?>

<div class="container">

    <h1><?php echo $formTitle; ?></h1>
    
    <?php if (isset($error) && $error): ?>
        <p class="error-message"><?php echo htmlspecialchars($error); ?></p>
    <?php endif; ?>

    <form action="<?php echo $actionUrl; ?>" method="POST">
        
        <?php if ($is_edit): ?>
            <input type="hidden" name="id" value="<?php echo htmlspecialchars($libro->id); ?>">
        <?php endif; ?>

        <div class="row">
            <div class="form">
                <label>Título libro</label>
                <input required name="titulo" type="text" value="<?php echo htmlspecialchars($titulo); ?>">
            </div>

            <div>
                <div class="form" >
                    <label>Genero</label>
                    <select required name="genero">
                        
                        <?php foreach ($generos as $genero_option): ?>
                            <option value="<?php echo $genero_option->id_genero; ?>" 
                                <?php if ($id_generoselec == $genero_option->id_genero) echo 'selected'; ?>>
                                <?php echo htmlspecialchars($genero_option->nombre); ?>
                            </option>
                        <?php endforeach; ?>
                        </select>
                </div>
            </div>
        </div>

        <div class="form">
            <label>Autor</label>
            <input name="autor" type="text" value="<?php echo htmlspecialchars($autor); ?>">
        </div>

        <div class="form">
            <label>Descripción</label>
            <textarea name="descripcion"><?php echo htmlspecialchars($descripcion); ?></textarea>
        </div>

        <button type="submit">Guardar</button>
        <a href="<?php echo BASE_URL; ?>listarlibros" class="btn btn-secondary">Volver</a>
    </form>
</div>